class map{
    constructor(map){
        this.name=map.name
        this.src=map;
        this.entityGroup=[];
        this.src.entity.forEach(e=>{
            this.entityGroup.push(e);
        });
        this.randomTrait();
        this.randonmQuality();
    }
    randomTrait(){
        this.entityGroup.forEach(e=>{
            if(e.type=="item"||e.type=="needToolItem"){
                let trait=[];
                for(let i=0;i<e.amount;i++){
                    trait.push(mapTraitGroup[this.name][Math.floor(Math.random()*mapTraitGroup[this.name].length)]);
                }
                e.trait=trait;
            }
        });
    }
    randonmQuality(){
        this.entityGroup.forEach(e=>{
            if(e.type=="item"||e.type=="needToolItem"){
                let quality=[];
                for(let i=0;i<e.amount;i++){
                    quality.push(mapQualityGroup[this.name][Math.floor(Math.random()*mapQualityGroup[this.name].length)]);
                }
                e.quality=quality;
            }
        });
    }
}
var Trial=[
    {
        "map":"CrystalCaveLeft",
        "name":"1",
        "hitbox":[1013,247,134,133],
        "item":[
            {
                "name":"野兽毛皮",
                "amount":4,
                "quality":[50,50,50,50],
                "trait":["品质提升","品质提升","品质提升","品质提升"]
            }
        ],
        "refreshTime":504
    }
]
var buystore=[
    {
        "map":"town",
        "name":"1",
        "hitbox":[452,340,375,300],
        "goods":[
            {
                "name":"冶炼秘术",
                "img":"stained-grimoire.webp",
                "amount":1,
                "quality":[100],
                "trait":[""],
                "price":1000,
                "refreshTime":-1
            },
            {
                "name":"高等冶炼术",
                "img":"stained-grimoire.webp",
                "amount":1,
                "quality":[100],
                "trait":[""],
                "price":5000,
                "refreshTime":-1
            },
        ],
    },
    {
        "map":"town",
        "name":"2",
        "hitbox":[231,348,151,293],
        "goods":[
            {
                "name":"宝石雕刻术",
                "img":"stained-grimoire.webp",
                "amount":1,
                "quality":[100],
                "trait":[""],
                "price":10000,
                "refreshTime":-1
            }
        ],
    }
]
var mapTraitGroup={
    "pathNearAtelier":[
        "",
        "",
        "",
        "",
        "",
        "品质提升",
        "低价",
        "高价"
    ],
    "pathToTheTown":[
        "",
        "",
        "",
        "",
        "",
        "品质提升",
        "品质提升",
        "品质提升",
        "品质提升+",
        "低价",
        "低价",
        "低价+",
        "高价",
        "高价"
    ],
    "CrystalCave":[
        "",
        "",
        "",
        "",        
        "品质提升",
        "品质提升",
        "品质提升",
        "品质提升+",
        "品质提升+",
        "品质提升++",
    ],
    "CrystalCaveRight":[
        "低价",
        "高价",
        "高价+",
        "高价+",        
        "品质提升",
        "品质提升",
        "品质提升",
        "品质提升+",
        "品质提升+",
        "品质提升++",
    ],
}
var mapQualityGroup={
    "pathNearAtelier":[
        5,
        5,
        10,
        10,
        10,
        10,
        20
    ],
    "pathToTheTown":[
        10,
        10,
        10,
        15,
        15,
        20,
        25
    ],
    "CrystalCave":[
        10,
        20,
        20,
        20,
        20,
        25,
        25,
        30,
        30,
        35,
        35
    ],
    "CrystalCaveRight":[
        30,
        30,
        40,
        40,
        50,
        50,
        50,
    ]
}

var atelier={
    "name":"atelier",
    "name1":"炼金工房",
    "background":"atelier.png",
    "entity":[
        {
            "type":"hitbox",//地板
            "hitbox":[0,640,1280,80]
        },
        {
            "type":"hitbox",//左侧墙
            "hitbox":[0,-240,80,960]
        },
        {
            "type":"hitbox",//右侧墙
            "hitbox":[1200,-240,80,610]
        },
        {
            "type":"hitbox",//门右边的碰撞箱
            "hitbox":[1280,240,80,480]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"door",
            "destinationMap":"pathNearAtelier",
            "destinationX":0,
            "destinationY":438,
            "hitbox":[1200,240,80,480]
        },
        {
            "type":"text",
            "hitbox":[200,540,200,100],
            "text":[
                "按E快进文本，文本结束后按E继续",
                "默认按键:tab暂停游戏，ad左右移动，空格跳跃，按q攻击，制作旅人之鞋后按shift疾跑，按w+空格高跳",
                "在光点处按E采集，在门处按E前往其他地图",
                "晨雾中的炼金工房，木质窗棂漏进细碎晨光，台面上还摆着半瓶未封装的草药精油，炉火烧得只剩余温……",
                "莉莉丝的指尖轻轻拂过工作台边缘 —— 那里留着奶奶多年前刻下的小太阳图案，说是能让炼制的药剂都带着暖意。可如今，再也不会有人在她熬夜炼金时，悄悄端来一杯加了蜂蜜的热牛奶，也不会有人笑着揉她的头发，说 “我们莉莉丝的天赋，迟早会超过我”。",
                "三天前，镇上来了送信的骑士，带来一纸盖着国王火漆印的律法文书。她至今记得文书上冰冷的字迹：“凡国内炼金工房，须于一百二十日内提交品质达标之天启与智慧之杖，经皇家炼金师鉴定不合格者，即刻吊销执照，永久关停。”",
                "这座工房，是奶奶用一辈子心血撑起来的。若是工房没了，奶奶留下的一切，那些藏在抽屉里的配方笔记、窗台上她亲手种的花、甚至是炉边那把磨得光滑的搅拌勺，都会跟着消失。",
                "窗外传来镇民的议论声，说西街的老约翰已经在收拾工房了，说国王的律法从来没有过回旋的余地。可莉莉丝攥紧了手心——奶奶说过，炼金术最神奇的地方，就是能从绝境里炼出希望。",
                "她深吸一口气，将律法文书叠好放进抽屉，转身点燃了炼金炉。炉火重新燃起的噼啪声里，她轻声说：“奶奶，我不会让这里消失的。一百二十天，我一定能做出那根法杖。”",
            ],
            "once":true
        },
        {
            "type":"pot",
            "hitbox":[240,320,254,320]
        }
    ]
}
var pathNearAtelier={
    "name":"pathNearAtelier",
    "name1":"工房旁小路",
    "background":"pathNearAtelier.png",
    "entity":[
        {
            "type":"hitbox",//地板
            "hitbox":[0,640,1360,80]
        },
        {
            "type":"hitbox",//左侧墙
            "hitbox":[0,0,80,393]
        },
        {
            "type":"hitbox",//上台阶
            "hitbox":[0,560,320,40]
        },
        {
            "type":"hitbox",//下台阶
            "hitbox":[0,600,360,400]
        },
        {
            "type":"hitbox",//右侧碰撞箱
            "hitbox":[1360,0,80,720]
        },
        {
            "type":"hitbox",//左门左边的碰撞箱
            "hitbox":[-80,393,80,167]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"text",
            "hitbox":[0,393,80,167],
            "text":[
                "每进入新的场景，都会消耗4小时的时间。（从炼金工房出去除外）"
            ],
            "once":true
        },
        {
            "type":"door",
            "destinationMap":"atelier",
            "destinationX":1168,
            "destinationY":518,
            "hitbox":[0,393,80,167]
        },
        {
            "type":"entrance",
            "destinationMap":"pathToTheTown",
            "destinationX":0,
            "destinationY":518,
            "hitbox":[1280,0,80,720]
        },
        {
            "type":"item",
            "itemname":"饮用水",
            "amount":4,
            "quality":[],
            "trait":[],
            "hitbox":[732,504,128,128]
        },
        {
            "type":"item",
            "itemname":"寻常草",
            "amount":3,
            "quality":[],
            "trait":[],
            "hitbox":[465,550,90,90]
        },
        // {
        //     "type":"recipeItem",
        //     "name":"喵",
        //     "hitbox":[600,400,200,200],
        //     "recipe":[
        //         {
        //             "name":"热情红宝石",
        //             "time":8,
        //             "recipe":{
        //                 "红宝石原石":4,
        //                 "抛光液":4,
        //                 "（燃料）":2
        //             }
        //         },
        //         {
        //             "name":"高贵蓝宝石",
        //             "time":16,
        //             "recipe":{
        //                 "热情红宝石":1,
        //                 "蓝宝石原石":4,
        //                 "纯水":4
        //             }
        //         },
        //         {
        //             "name":"诚实黄宝石",
        //             "time":32,
        //             "recipe":{
        //                 "高贵蓝宝石":1,
        //                 "黄宝石原石":4,
        //                 "（金属)":3
        //             }
        //         },
        //         {
        //             "name":"睿智绿宝石",
        //             "time":64,
        //             "recipe":{
        //                 "诚实黄宝石":1,
        //                 "绿宝石原石":4,
        //                 "（气体）":3
        //             }
        //         }
        //     ]
        // }
    ]
}
var pathToTheTown={
    "name":"pathToTheTown",
    "name1":"通往城镇的小路",
    "background":"pathToTheTown.png",
    "entity":[
        {
            "type":"hitbox",//地板左
            "hitbox":[-80,640,600,160]
        },
        {
            "type":"hitbox",//地板右
            "hitbox":[680,640,680,160]
        },
        {
            "type":"hitbox",//左侧碰撞箱
            "hitbox":[-160,0,80,720]
        },
        {
            "type":"hitbox",//右侧碰撞箱
            "hitbox":[1420,0,80,720]
        },
        {
            "type":"hitbox",//下侧碰撞箱
            "hitbox":[520,800,160,80]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"item",
            "itemname":"直木",
            "amount":5,
            "quality":[],
            "trait":[],
            "hitbox":[160,512,128,128]
        },
        {
            "type":"entrance",
            "destinationMap":"pathNearAtelier",
            "destinationX":1168,
            "destinationY":518,
            "hitbox":[-80,0,80,720]
        },
        {
            "type":"entrance",
            "destinationMap":"CrystalCave",
            "destinationX":250,
            "destinationY":0,
            "hitbox":[520,720,160,80]
        },
        {
            "type":"entrance",
            "destinationMap":"town",
            "destinationX":0,
            "destinationY":518,
            "hitbox":[1280,0,80,720]
        },
        {
            "type":"item",
            "itemname":"蓝色的花",
            "amount":2,
            "quality":[],
            "trait":[],
            "hitbox":[732,585,81,81]
        },
        {
            "type":"item",
            "itemname":"黄色的花",
            "amount":2,
            "quality":[],
            "trait":[],
            "hitbox":[838,594,66,66]
        },
        {
            "type":"item",
            "itemname":"红色的花",
            "amount":2,
            "quality":[],
            "trait":[],
            "hitbox":[920,594,66,66]
        },
        {
            "type":"item",
            "itemname":"绿色的花",
            "amount":2,
            "quality":[],
            "trait":[],
            "hitbox":[1014,588,85,85]
        },
        {
            "type":"item",
            "itemname":"白色的花",
            "amount":2,
            "quality":[],
            "trait":[],
            "hitbox":[1146,585,85,85]
        }
    ]
}
var CrystalCave={
    "name":"CrystalCave",
    "name1":"水晶洞穴",
    "background":"CrystalCave.jpg",
    "entity":[
        {
            "type":"hitbox",
            "hitbox":[0,0,250,80]
        },
        {
            "type":"hitbox",
            "hitbox":[640,0,250,80]
        },
        {
            "type":"hitbox",
            "hitbox":[960,0,320,96]
        },
        {
            "type":"hitbox",
            "hitbox":[260,150,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[430,350,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[100,450,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[1160,354,120,10]
        },
        {
            "type":"hitbox",
            "hitbox":[1000,440,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[0,640,1280,80]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"puni",
            "name":"蓝噗尼",
            "img":"blue-puni",
            "hitbox":[180,366,64,84],
            "actRange":[110,366,140,84],
            "damage":1,
            "hearts":8
        },
        {
            "type":"entrance",
            "destinationMap":"pathToTheTown",
            "destinationX":560,
            "destinationY":398,
            "hitbox":[250,-80,490,80]
        },
        {
            "type":"entrance",
            "destinationMap":"CrystalCaveRight",
            "destinationX":0,
            "destinationY":518,
            "hitbox":[1280,450,80,190]
        },
        {
            "type":"entrance",
            "destinationMap":"CrystalCaveRight",
            "destinationX":0,
            "destinationY":318,
            "hitbox":[1280,95,80,260]
        },
        {
            "type":"entrance",
            "destinationMap":"CrystalCaveLeft",
            "destinationX":1196,
            "destinationY":518,
            "hitbox":[-80,0,80,720]
        },
        {
            "type":"item",
            "itemname":"艾森矿",
            "amount":3,
            "quality":[],
            "trait":[],
            "hitbox":[1076,354,81,81]
        },
        {
            "type":"item",
            "itemname":"艾森矿",
            "amount":3,
            "quality":[],
            "trait":[],
            "hitbox":[105,555,81,81]
        },
        {
            "type":"item",
            "itemname":"白砂",
            "amount":4,
            "quality":[],
            "trait":[],
            "hitbox":[130,365,81,81]
        },
    ]
}
var CrystalCaveRight={
    "name":"CrystalCaveRight",
    "name1":"水晶洞穴右",
    "background":"CrystalCaveRight.png",
    "entity":[
        {
            "type":"hitbox",
            "hitbox":[0,440,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[350,350,320,10]
        },
        {
            "type":"hitbox",
            "hitbox":[670,340,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[830,400,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[1120,450,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[0,640,1280,80]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"entrance",
            "destinationMap":"CrystalCave",
            "destinationX":1168,
            "destinationY":518,
            "hitbox":[-80,0,80,440]
        },
        {
            "type":"entrance",
            "destinationMap":"CrystalCave",
            "destinationX":1196,
            "destinationY":232,
            "hitbox":[-80,450,80,270]
        },
        {
            "type":"needToolItem",
            "itemname":"黄金色之岩",
            "amount":1,
            "quality":[],
            "trait":[],
            "needTool":4,
            "hitbox":[682,496,103,103]
        }
    ]
}
var CrystalCaveLeft={
    "name":"CrystalCaveLeft",
    "name1":"水晶洞穴左",
    "background":"CrystalCaveLeft.png",
    "entity":[
        {
            "type":"hitbox",
            "hitbox":[370,260,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[550,430,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[1000,380,160,10]
        },
        {
            "type":"hitbox",
            "hitbox":[0,640,1280,80]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"entrance",
            "destinationMap":"CrystalCave",
            "destinationX":0,
            "destinationY":518,
            "hitbox":[1280,0,80,720]
        },
    ]
}
var town={
    "name":"town",
    "name1":"城镇",
    "background":"town.png",
    "entity":[
        {
            "type":"hitbox",
            "hitbox":[0,640,1280,80]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"sellstore",
            "name":"1",
            "hitbox":[996,348,151,293]
        },
        {
            "type":"entrance",
            "destinationMap":"pathToTheTown",
            "destinationX":1196,
            "destinationY":518,
            "hitbox":[-80,0,80,720]
        },
        {
            "type":"entrance",
            "destinationMap":"townRight",
            "destinationX":0,
            "destinationY":518,
            "hitbox":[1280,0,80,720]
        }
    ]
}
var townRight={
    "name":"townRight",
    "name1":"城镇右",
    "background":"townRight.jpg",
    "entity":[
        {
            "type":"hitbox",
            "hitbox":[90,270,160,16]
        },
        {
            "type":"hitbox",
            "hitbox":[270,420,320,16]
        },
        {
            "type":"hitbox",
            "hitbox":[960,400,160,16]
        },
        {
            "type":"hitbox",
            "hitbox":[1120,380,160,16]
        },
        {
            "type":"hitbox",
            "hitbox":[0,640,960,80]
        },
        {
            "type":"hitbox",
            "hitbox":[960,700,320,20]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"entrance",
            "destinationMap":"town",
            "destinationX":1196,
            "destinationY":518,
            "hitbox":[-80,0,80,720]
        },
        {
            "type":"entrance",
            "destinationMap":"mountainCave1",
            "destinationX":0,
            "destinationY":518,
            "hitbox":[1280,396,80,340]
        },
        {
            "type":"entrance",
            "destinationMap":"peak",
            "destinationX":0,
            "destinationY":518,
            "hitbox":[1280,0,80,380]
        },
        {
            "type":"dog",
            "name":"狗",
            "img":"dog",
            "hitbox":[754,550,90,90],
            "damage":2,
            "hearts":20
        },
    ]
}
var peak={
    "name":"peak",
    "name1":"山顶",
    "background":"peak.jpg",
    "entity":[
        {
            "type":"hitbox",
            "hitbox":[60,180,480,16]
        },
        {
            "type":"hitbox",
            "hitbox":[800,230,160,16]
        },
        {
            "type":"hitbox",
            "hitbox":[240,370,160,16]
        },
        {
            "type":"hitbox",
            "hitbox":[400,400,160,16]
        },
        {
            "type":"hitbox",
            "hitbox":[800,455,160,16]
        },
        {
            "type":"hitbox",
            "hitbox":[0,640,1280,80]
        },
        {
            "type":"hitbox",
            "hitbox":[1280,0,80,720]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"entrance",
            "destinationMap":"townRight",
            "destinationX":1196,
            "destinationY":258,
            "hitbox":[-80,0,80,720]
        }
    ]
}
var mountainCave1={
    "name":"mountainCave1",
    "name1":"山洞",
    "background":"mountainCave1.png",
    "entity":[
        {
            "type":"hitbox",
            "hitbox":[0,272,176,58]
        },
        {
            "type":"hitbox",
            "hitbox":[431,154,187,29]
        },
        {
            "type":"hitbox",
            "hitbox":[633,325,318,25]
        },
        {
            "type":"hitbox",
            "hitbox":[482,474,186,27]
        },
        {
            "type":"hitbox",
            "hitbox":[0,640,1280,80]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"entrance",
            "destinationMap":"townRight",
            "destinationX":1196,
            "destinationY":518,
            "hitbox":[-80,0,80,720]
        },
        {
            "type":"entrance",
            "destinationMap":"mountainCave2",
            "destinationX":0,
            "destinationY":518,
            "hitbox":[1280,0,80,720]
        },
    ]
}
var mountainCave2={
    "name":"mountainCave2",
    "name1":"山洞",
    "background":"mountainCave2.png",
    "entity":[
        {
            "type":"hitbox",
            "hitbox":[159,317,287,22]
        },
        {
            "type":"hitbox",
            "hitbox":[650,194,259,26]
        },
        {
            "type":"hitbox",
            "hitbox":[1069,320,187,21]
        },
        {
            "type":"hitbox",
            "hitbox":[919,494,253,23]
        },
        {
            "type":"hitbox",
            "hitbox":[0,640,1280,80]
        },
        {
            "type":"hitbox",
            "hitbox":[0,0,355,50]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"entrance",
            "destinationMap":"mountainCave1",
            "destinationX":1196,
            "destinationY":518,
            "hitbox":[-80,0,80,720]
        },
        {
            "type":"entrance",
            "destinationMap":"mountainCave3",
            "destinationX":0,
            "destinationY":518,
            "hitbox":[1280,0,80,720]
        },
    ]
}
var mountainCave3={
    "name":"mountainCave3",
    "name1":"山洞",
    "background":"mountainCave3.png",
    "entity":[
        {
            "type":"hitbox",
            "hitbox":[885,0,393,78]
        },
        {
            "type":"hitbox",
            "hitbox":[598,170,257,13]
        },
        {
            "type":"hitbox",
            "hitbox":[274,319,315,27]
        },
        {
            "type":"hitbox",
            "hitbox":[771,422,344,22]
        },
        {
            "type":"hitbox",
            "hitbox":[0,640,1280,80]
        },
        {
            "type":"hitbox",
            "hitbox":[1280,0,80,720]
        },
        {
            "type":"hitbox",
            "hitbox":[0,-240,1280,80]
        },
        {
            "type":"entrance",
            "destinationMap":"mountainCave2",
            "destinationX":1196,
            "destinationY":518,
            "hitbox":[-80,0,80,720]
        },
    ]
}