<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>战斗游戏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            font-family: 'Press Start 2P', cursive;
            background: #0c1445;
            color: white;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: crosshair;
        }
        
        #game-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            image-rendering: pixelated;
        }
        
        #game-canvas {
            width: 100%;
            height: 100%;
            background: #0c1445;
        }
        
        .health-bar {
            position: absolute;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #fff;
            z-index: 10;
        }
        
        .health-fill {
            height: 100%;
            transition: width 0.3s;
        }
        
        #player-health {
            top: 20px;
            left: 20px;
            width: 300px;
        }
        
        #player-health .health-fill {
            background: linear-gradient(to right, #ff3300, #ff8800);
            width: 100%;
        }
        
        #monster-health {
            top: 20px;
            right: 20px;
            width: 300px;
        }
        
        #monster-health .health-fill {
            background: linear-gradient(to right, #ff3300, #ff8800);
            width: 100%;
        }
        
        #controls {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border: 2px solid #00ff00;
            border-radius: 8px;
            z-index: 10;
            display: flex;
            gap: 15px;
        }
        
        .control-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .key {
            display: inline-block;
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            border: 2px solid #666;
            font-size: 14px;
        }
        
        #power-up-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            color: #ffcc00;
            text-shadow: 0 0 10px #ff9900;
            opacity: 0;
            pointer-events: none;
            z-index: 20;
            text-align: center;
        }
        
        #game-over, #victory {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30;
            display: none;
        }
        
        #game-over h2, #victory h2 {
            font-size: 48px;
            color: #ff3333;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }
        
        #victory h2 {
            color: #00ff00;
        }
        
        #restart-btn {
            padding: 15px 30px;
            font-size: 20px;
            background: linear-gradient(to bottom, #ffcc00, #ff9900);
            border: none;
            border-radius: 8px;
            color: #333;
            cursor: pointer;
            font-family: 'Press Start 2P', cursive;
            margin-top: 20px;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
        }
        
        #restart-btn:hover {
            background: linear-gradient(to bottom, #ffdd22, #ffaa22);
            transform: translateY(-2px);
        }
        
        .stats {
            position: absolute;
            top: 60px;
            z-index: 10;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        #player-stats {
            left: 20px;
        }
        
        #monster-stats {
            right: 20px;
        }
        
        .fireball {
            position: absolute;
            width: 20px;
            height: 20px;
            z-index: 5;
            border-radius: 50%;
        }
        
        #aim-indicator {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid #ff9900;
            border-radius: 50%;
            pointer-events: none;
            z-index: 25;
            display: none;
        }
        
        #attack-direction {
            position: absolute;
            pointer-events: none;
            z-index: 24;
            display: none;
        }
        
        .platform {
            position: absolute;
            background: #7c4dff;
            border: 2px solid #5e35b1;
            border-radius: 5px;
        }
        
        #ground {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: #5d4037;
            border-top: 10px solid #388e3c;
            z-index: 5;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        
        <div id="ground"></div>
        
        <div id="player-health" class="health-bar">
            <div class="health-fill" id="player-health-bar"></div>
        </div>
        
        <div id="monster-health" class="health-bar">
            <div class="health-fill" id="monster-health-bar"></div>
        </div>
        
        <div id="player-stats" class="stats">
            攻击力: <span id="player-attack">10</span>
        </div>
        
        <div id="monster-stats" class="stats">
            攻击力: <span id="monster-attack">10</span>
        </div>
        
        <div id="controls">
            <div class="control-item">
                <span class="key">A</span> 左移
            </div>
            <div class="control-item">
                <span class="key">D</span> 右移
            </div>
            <div class="control-item">
                <span class="key">W</span> 跳跃
            </div>
            <div class="control-item">
                <span class="key">鼠标</span> 瞄准
            </div>
            <div class="control-item">
                <span class="key">左键</span> 攻击
            </div>
        </div>
        
        <div id="aim-indicator"></div>
        <div id="attack-direction"></div>
        
        <div id="power-up-effect">
            <div>攻击力提升!</div>
            <div>+5 攻击力</div>
        </div>
        
        <div id="game-over">
            <h2>游戏结束</h2>
            <p>你被怪兽击败了</p>
            <button id="restart-btn">重新开始</button>
        </div>
        
        <div id="victory">
            <h2>胜利!</h2>
            <p>你击败了怪兽!</p>
            <button id="restart-btn">再战一局</button>
        </div>
    </div>

    <script>
        // 游戏画布和上下文
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        
        // 设置画布尺寸为全屏
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // ==================== 贴图配置区域 ====================
        
        // 背景贴图
        const BACKGROUND_IMAGE_URL = "战斗游戏背景.jpg";
        
        // 玩家贴图
        const PLAYER_IMAGE_URL = "Lilies.png";
        
        // 怪物贴图
        const MONSTER_IMAGE_URL = "https://placehold.co/70x90/d32f2f/white?text=怪物";
        
        // 平台贴图
        const PLATFORM_IMAGE_URL = "地板图片.png";
        
        // 地面贴图
        const GROUND_IMAGE_URL = "地板图片.png";
        
        // =====================================================
        
        // 加载图像资源
        const images = {
            background: new Image(),
            player: new Image(),
            monster: new Image(),
            platform: new Image(),
            ground: new Image()
        };
        
        // 设置图像源
        images.background.src = BACKGROUND_IMAGE_URL;
        images.player.src = PLAYER_IMAGE_URL;
        images.monster.src = MONSTER_IMAGE_URL;
        images.platform.src = PLATFORM_IMAGE_URL;
        images.ground.src = GROUND_IMAGE_URL;
        
        // 跟踪图像加载状态
        let imagesLoaded = 0;
        const totalImages = Object.keys(images).length;
        
        // 游戏状态
        const gameState = {
            player: {
                x: 100,
                y: canvas.height - 200,
                width: 50,
                height: 70,
                speed: 5,
                jumpPower: 15,
                velocityY: 0,
                isJumping: false,
                health: 100,
                maxHealth: 100,
                attack: 10,
                facing: 'right',
                attackCooldown: 0,
                fireballCooldown: 0,
                onGround: false
            },
            monster: {
                x: canvas.width - 200,
                y: canvas.height - 180,
                width: 70,
                height: 90,
                health: 80,
                maxHealth: 80,
                attack: 8,
                attackCooldown: 0,
                isAttacking: false,
                direction: -1,
                moveTimer: 0,
                velocityY: 0,
                onGround: false
            },
            platforms: [
                {x: 0, y: canvas.height - 60, width: canvas.width, height: 60},
                {x: 200, y: canvas.height - 200, width: 200, height: 20},
                {x: 500, y: canvas.height - 300, width: 200, height: 20},
                {x: 800, y: canvas.height - 200, width: 200, height: 20},
                {x: canvas.width - 300, y: canvas.height - 250, width: 200, height: 20}
            ],
            fireballs: {
                player: [],
                monster: []
            },
            gravity: 0.8,
            keys: {},
            gameOver: false,
            victory: false,
            mouse: {
                x: 0,
                y: 0,
                isDown: false
            },
            groundLevel: canvas.height - 60,
            imagesReady: false
        };
        
        // 图像加载完成检查
        function checkAllImagesLoaded() {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                gameState.imagesReady = true;
            }
        }
        
        // 设置图像加载回调
        Object.values(images).forEach(image => {
            image.onload = checkAllImagesLoaded;
            image.onerror = () => {
                console.log("图像加载失败，使用默认绘制");
                checkAllImagesLoaded();
            };
        });
        
        // 碰撞检测函数
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }
        
        // 平台碰撞检测
        function checkPlatformCollision(entity, platforms) {
            entity.onGround = false;
            
            // 先应用重力
            entity.velocityY += gameState.gravity;
            entity.y += entity.velocityY;
            
            // 检查与每个平台的碰撞
            for (const platform of platforms) {
                // 如果实体正在下落并且与平台顶部碰撞
                if (entity.velocityY > 0 && 
                    entity.x + entity.width > platform.x && 
                    entity.x < platform.x + platform.width &&
                    entity.y + entity.height > platform.y &&
                    entity.y + entity.height <= platform.y + 10) {
                    
                    entity.y = platform.y - entity.height;
                    entity.velocityY = 0;
                    entity.onGround = true;
                    entity.isJumping = false;
                }
                
                // 防止从侧面穿过平台
                if (entity.x + entity.width > platform.x && 
                    entity.x < platform.x + platform.width &&
                    entity.y + entity.height > platform.y &&
                    entity.y < platform.y + platform.height) {
                    
                    // 从左向右移动时碰撞
                    if (entity.x + entity.width - 5 <= platform.x && entity.velocityY >= 0) {
                        entity.x = platform.x - entity.width;
                    }
                    // 从右向左移动时碰撞
                    else if (entity.x >= platform.x + platform.width - 5 && entity.velocityY >= 0) {
                        entity.x = platform.x + platform.width;
                    }
                }
            }
            
            // 确保不会掉出屏幕底部
            if (entity.y + entity.height > gameState.groundLevel) {
                entity.y = gameState.groundLevel - entity.height;
                entity.velocityY = 0;
                entity.onGround = true;
                entity.isJumping = false;
            }
        }
        
        // 初始化游戏
        function init() {
            // 设置事件监听器
            window.addEventListener('keydown', (e) => {
                gameState.keys[e.key] = true;
            });
            
            window.addEventListener('keyup', (e) => {
                gameState.keys[e.key] = false;
            });
            
            // 鼠标事件监听
            canvas.addEventListener('mousemove', (e) => {
                gameState.mouse.x = e.clientX;
                gameState.mouse.y = e.clientY;
                updateAimIndicator();
            });
            
            canvas.addEventListener('mousedown', (e) => {
                if (e.button === 0) { // 左键
                    gameState.mouse.isDown = true;
                    if (gameState.player.fireballCooldown <= 0) {
                        fireballAttack();
                        gameState.player.fireballCooldown = 30;
                    }
                }
            });
            
            canvas.addEventListener('mouseup', (e) => {
                if (e.button === 0) {
                    gameState.mouse.isDown = false;
                }
            });
            
            // 重新开始按钮
            document.getElementById('restart-btn').addEventListener('click', resetGame);
            
            // 开始游戏循环
            gameLoop();
        }
        
        // 游戏主循环
        function gameLoop() {
            if (!gameState.gameOver && !gameState.victory) {
                update();
            }
            render();
            requestAnimationFrame(gameLoop);
        }
        
        // 更新游戏状态
        function update() {
            const { player, monster, keys } = gameState;
            
            // 玩家移动
            if (keys['a'] || keys['A'] || keys['ArrowLeft']) {
                player.x -= player.speed;
                player.facing = 'left';
            }
            
            if (keys['d'] || keys['D'] || keys['ArrowRight']) {
                player.x += player.speed;
                player.facing = 'right';
            }
            
            // 玩家跳跃
            if ((keys['w'] || keys['W'] || keys['ArrowUp']) && player.onGround) {
                player.velocityY = -player.jumpPower;
                player.isJumping = true;
                player.onGround = false;
            }
            
            // 冷却时间更新
            if (player.attackCooldown > 0) {
                player.attackCooldown--;
            }
            
            if (player.fireballCooldown > 0) {
                player.fireballCooldown--;
            }
            
            // 更新玩家位置和碰撞
            checkPlatformCollision(player, gameState.platforms);
            
            // 更新火球
            updateFireballs();
            
            // 更新怪物
            updateMonster();
            
            // 边界检测
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
            
            // 胜利条件检测
            if (monster.health <= 0) {
                monster.health = 0;
                gameState.victory = true;
                document.getElementById('victory').style.display = 'flex';
            }
        }
        
        // 更新怪物行为
        function updateMonster() {
            const { monster, player } = gameState;
            
            // 怪物移动
            monster.moveTimer--;
            if (monster.moveTimer <= 0) {
                // 决定移动方向：随机或朝向玩家
                if (Math.random() > 0.7) {
                    monster.direction = player.x < monster.x ? -1 : 1;
                } else {
                    monster.direction = Math.random() > 0.5 ? 1 : -1;
                }
                monster.moveTimer = Math.random() * 100 + 50;
            }
            
            monster.x += monster.direction * 2;
            
            // 怪物边界检测
            if (monster.x < 0) {
                monster.x = 0;
                monster.direction = 1;
            }
            if (monster.x + monster.width > canvas.width) {
                monster.x = canvas.width - monster.width;
                monster.direction = -1;
            }
            
            // 更新怪物位置和碰撞
            checkPlatformCollision(monster, gameState.platforms);
            
            // 怪物攻击
            monster.attackCooldown--;
            if (monster.attackCooldown <= 0 && 
                Math.abs(player.x - monster.x) < 400 &&
                Math.abs(player.y - monster.y) < 200) {
                
                // 怪物发射火球
                const dx = player.x + player.width/2 - (monster.x + monster.width/2);
                const dy = player.y + player.height/2 - (monster.y + monster.height/2);
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 0) {
                    gameState.fireballs.monster.push({
                        x: monster.x + monster.width/2,
                        y: monster.y + monster.height/2,
                        width: 20,
                        height: 20,
                        speedX: (dx / distance) * 5,
                        speedY: (dy / distance) * 5,
                        type: 'monster'
                    });
                    
                    monster.attackCooldown = 60;
                }
            }
        }
        
        // 更新火球状态
        function updateFireballs() {
            // 玩家火球
            for (let i = gameState.fireballs.player.length - 1; i >= 0; i--) {
                const fireball = gameState.fireballs.player[i];
                
                // 移动火球
                fireball.x += fireball.speedX;
                fireball.y += fireball.speedY;
                
                // 检测火球是否击中怪物
                if (checkCollision(fireball, gameState.monster)) {
                    // 击中怪物
                    gameState.monster.health -= gameState.player.attack;
                    updateHealthBars();
                    gameState.fireballs.player.splice(i, 1);
                    
                    // 检查是否击败怪物
                    if (gameState.monster.health <= 0) {
                        // 提升玩家攻击力
                        gameState.player.attack += 5;
                        document.getElementById('player-attack').textContent = gameState.player.attack;
                        
                        // 显示攻击力提升特效
                        showPowerUpEffect();
                    }
                    continue;
                }
                
                // 移除超出屏幕的火球
                if (fireball.x < 0 || fireball.x > canvas.width || 
                    fireball.y < 0 || fireball.y > canvas.height) {
                    gameState.fireballs.player.splice(i, 1);
                }
            }
            
            // 怪物火球
            for (let i = gameState.fireballs.monster.length - 1; i >= 0; i--) {
                const fireball = gameState.fireballs.monster[i];
                
                // 移动火球
                fireball.x += fireball.speedX;
                fireball.y += fireball.speedY;
                
                // 检测火球是否击中玩家
                if (checkCollision(fireball, gameState.player)) {
                    // 击中玩家
                    gameState.player.health -= gameState.monster.attack;
                    updateHealthBars();
                    gameState.fireballs.monster.splice(i, 1);
                    
                    if (gameState.player.health <= 0) {
                        gameState.player.health = 0;
                        gameState.gameOver = true;
                        document.getElementById('game-over').style.display = 'flex';
                    }
                    continue;
                }
                
                // 移除超出屏幕的火球
                if (fireball.x < 0 || fireball.x > canvas.width || 
                    fireball.y < 0 || fireball.y > canvas.height) {
                    gameState.fireballs.monster.splice(i, 1);
                }
            }
        }
        
        // 更新瞄准指示器
        function updateAimIndicator() {
            const indicator = document.getElementById('aim-indicator');
            indicator.style.left = (gameState.mouse.x - 10) + 'px';
            indicator.style.top = (gameState.mouse.y - 10) + 'px';
            indicator.style.display = 'block';
            
            // 更新攻击方向线
            const direction = document.getElementById('attack-direction');
            const playerCenterX = gameState.player.x + gameState.player.width/2;
            const playerCenterY = gameState.player.y + gameState.player.height/2;
            
            direction.style.left = playerCenterX + 'px';
            direction.style.top = playerCenterY + 'px';
            
            const dx = gameState.mouse.x - playerCenterX;
            const dy = gameState.mouse.y - playerCenterY;
            const angle = Math.atan2(dy, dx);
            const length = Math.min(Math.sqrt(dx*dx + dy*dy), 150);
            
            direction.style.width = length + 'px';
            direction.style.height = '2px';
            direction.style.background = '#ff9900';
            direction.style.transform = `rotate(${angle}rad)`;
            direction.style.transformOrigin = '0 0';
            direction.style.display = 'block';
        }
        
        // 渲染游戏
        function render() {
            // 清除画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制背景
            drawBackground();
            
            // 绘制平台
            drawPlatforms();
            
            // 绘制玩家
            drawPlayer();
            
            // 绘制怪物
            drawMonster();
            
            // 绘制火球
            drawFireballs();
        }
        
        // 绘制背景
        function drawBackground() {
            if (gameState.imagesReady) {
                // 使用贴图绘制背景
                ctx.drawImage(images.background, 0, 0, canvas.width, canvas.height);
            } else {
                // 备用背景
                ctx.fillStyle = '#0c1445';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        }
        
        // 绘制平台
        function drawPlatforms() {
            for (const platform of gameState.platforms) {
                if (gameState.imagesReady) {
                    // 使用贴图绘制平台
                    ctx.drawImage(images.platform, platform.x, platform.y, platform.width, platform.height);
                } else {
                    // 备用平台绘制
                    ctx.fillStyle = '#7c4dff';
                    ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                    
                    // 平台顶部边缘
                    ctx.fillStyle = '#5e35b1';
                    ctx.fillRect(platform.x, platform.y, platform.width, 5);
                }
            }
            
            // 绘制地面
            if (gameState.imagesReady) {
                ctx.drawImage(images.ground, 0, gameState.groundLevel, canvas.width, canvas.height - gameState.groundLevel);
            } else {
                ctx.fillStyle = '#5d4037';
                ctx.fillRect(0, gameState.groundLevel, canvas.width, canvas.height - gameState.groundLevel);
                
                // 地面顶部边缘
                ctx.fillStyle = '#388e3c';
                ctx.fillRect(0, gameState.groundLevel, canvas.width, 10);
            }
        }
        
        // 绘制玩家
        function drawPlayer() {
            const { x, y, width, height, facing } = gameState.player;
            
            if (gameState.imagesReady) {
                // 使用贴图绘制玩家
                ctx.save();
                
                // 如果面向左边，翻转图像
                if (facing === 'left') {
                    ctx.scale(-1, 1);
                    ctx.drawImage(images.player, -x - width, y, width, height);
                } else {
                    ctx.drawImage(images.player, x, y, width, height);
                }
                
                ctx.restore();
            } else {
                // 备用玩家绘制
                ctx.fillStyle = '#1976d2';
                ctx.fillRect(x, y, width, height);
                
                // 玩家头部
                ctx.fillStyle = '#ffccbc';
                ctx.fillRect(x + 10, y - 10, width - 20, 15);
                
                // 玩家眼睛
                ctx.fillStyle = '#000';
                ctx.fillRect(x + 15, y - 5, 5, 5);
                ctx.fillRect(x + width - 20, y - 5, 5, 5);
            }
        }
        
        // 绘制怪物
        function drawMonster() {
            const { x, y, width, height } = gameState.monster;
            
            if (gameState.imagesReady) {
                // 使用贴图绘制怪物
                ctx.drawImage(images.monster, x, y, width, height);
            } else {
                // 备用怪物绘制
                ctx.fillStyle = '#d32f2f';
                ctx.fillRect(x, y, width, height);
                
                // 怪物眼睛
                ctx.fillStyle = '#000';
                ctx.fillRect(x + 15, y + 15, 10, 10);
                ctx.fillRect(x + width - 25, y + 15, 10, 10);
                
                // 怪物嘴巴
                ctx.fillStyle = '#000';
                ctx.fillRect(x + 20, y + height - 20, width - 40, 5);
            }
        }
        
        // 绘制火球
        function drawFireballs() {
            // 玩家火球
            for (const fireball of gameState.fireballs.player) {
                ctx.fillStyle = '#ff9900';
                ctx.beginPath();
                ctx.arc(fireball.x, fireball.y, fireball.width/2, 0, Math.PI * 2);
                ctx.fill();
                
                // 火球光晕
                ctx.fillStyle = 'rgba(255, 200, 0, 0.5)';
                ctx.beginPath();
                ctx.arc(fireball.x, fireball.y, fireball.width/2 + 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // 怪物火球
            for (const fireball of gameState.fireballs.monster) {
                ctx.fillStyle = '#ff3366';
                ctx.beginPath();
                ctx.arc(fireball.x, fireball.y, fireball.width/2, 0, Math.PI * 2);
                ctx.fill();
                
                // 火球光晕
                ctx.fillStyle = 'rgba(255, 100, 100, 0.5)';
                ctx.beginPath();
                ctx.arc(fireball.x, fireball.y, fireball.width/2 + 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // 火球攻击逻辑
        function fireballAttack() {
            const { player, mouse } = gameState;
            const playerCenterX = player.x + player.width/2;
            const playerCenterY = player.y + player.height/2;
            
            const dx = mouse.x - playerCenterX;
            const dy = mouse.y - playerCenterY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance > 0) {
                gameState.fireballs.player.push({
                    x: playerCenterX,
                    y: playerCenterY,
                    width: 20,
                    height: 20,
                    speedX: (dx / distance) * 10,
                    speedY: (dy / distance) * 10,
                    type: 'player'
                });
            }
        }
        
        // 更新血条显示
        function updateHealthBars() {
            const { player, monster } = gameState;
            
            // 更新玩家血条
            const playerHealthPercent = (player.health / player.maxHealth) * 100;
            document.getElementById('player-health-bar').style.width = `${playerHealthPercent}%`;
            
            // 更新怪物血条
            const monsterHealthPercent = (monster.health / monster.maxHealth) * 100;
            document.getElementById('monster-health-bar').style.width = `${monsterHealthPercent}%`;
        }
        
        // 显示攻击力提升特效
        function showPowerUpEffect() {
            const effect = document.getElementById('power-up-effect');
            effect.style.opacity = '1';
            effect.style.transform = 'translate(-50%, -50%) scale(1.5)';
            
            setTimeout(() => {
                effect.style.opacity = '0';
                effect.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 1500);
        }
        
        // 重置游戏
        function resetGame() {
            const { player, monster } = gameState;
            
            // 重置玩家状态
            player.x = 100;
            player.y = canvas.height - 200;
            player.health = player.maxHealth;
            player.attack = 10;
            player.velocityY = 0;
            
            // 重置怪物状态
            monster.x = canvas.width - 200;
            monster.y = canvas.height - 180;
            monster.health = monster.maxHealth;
            monster.velocityY = 0;
            
            // 清空火球
            gameState.fireballs.player = [];
            gameState.fireballs.monster = [];
            
            // 重置游戏状态
            gameState.gameOver = false;
            gameState.victory = false;
            
            // 更新UI
            updateHealthBars();
            document.getElementById('player-attack').textContent = player.attack;
            document.getElementById('game-over').style.display = 'none';
            document.getElementById('victory').style.display = 'none';
        }
        
        // 初始化游戏
        window.onload = init;
    </script>
</body>
</html>